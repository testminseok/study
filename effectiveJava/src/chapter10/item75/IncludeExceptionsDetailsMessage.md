# 예외의 상세 메시지에 실패 관련 정보를 담으라
예외를 잡지 못해 프로그램이 실패하면 자바 시스템은 그 예외의 스택 추적 정보를 자동으로 출력한다.
스택 추적은 예외 객체의 toString 메서드를 호출해 얻는 문자열로, 보통은 예외의 클래스 이름 뒤에 상세 메세지가 붙는 형태이다.
이 정보가 실패 원인을 분석해야 하는 개발자 혹은 사이트 신뢰성 엔지니어(SRE)가 얻을 수 있는 유일한 정보인 경우가 많다.
더구나 그 실패를 재현하기 어렵다면 더 자세한 정보를 얻기가 어렵거나 불가능하다. 따라서 예외의 toString 메서드에 실패 원인에 관한 
정보를 가능한 한 많이 담아 반환하는 일은 아주 중요하다. 사후 분석을 위해 실패 순간의 상황을 정확히 포착해 예외의 상세 메세지를 담아야한다.

**실패 순간을 포착하려면 발생한 예외에 관여한 모든 매개변수와 필드의 값을 실패 메세지에 담아야한다.**
예를 들면 IndexOutOfBoundsException 의 상세 메세지는 범위의 최솟값과 최댓값, 그리고 그 범위를 벗어났다는 인덱스의 값을 담아야한다.
이러한 정보는 여러가지 이상현상의 원인하고 분석하는 데 파악하는데 큰 도움이 된다.
> 보안과 관련된 예외는 실패 원인을 상세 메세지에 담으면 안된다. 
> 예를 들어 잘못된 암호나 암호화 키를 사용했다면 그 값을 상세 메세지에 담으면 안된다.

예외의 상세 메세지와 최종 사용자에게 보여줄 오류 메세지를 혼동하지말자.
최종 사용자에겐 친절한 안내메세지를 보여줘야 한다. 예외 메세지는 가독성 보다는 담긴 내용이 더 중요하다.
예외 메세지의 주 소비층은 주로 문제를 분석해야 할 개발자와 SRE 이기 때문이다.

실패를 적절히 포착하려면 필요한 정보를 예외 생성자에서 모두 받아서 상세 메세지까지 미리 생성해놓는 방법도 괜찮다.
현재 IndexOutOfBoundsException 의 생성자는 String 을 받지만, 다음과 같이 구현했어도 좋았을 것이다.
```java
/**
 * IndexOutOfBoundsException을 생성한다.
 * 
 * @param lowerBound 인덱스의 최솟값
 * @param upperBound 인덱스의 최댓값 + 1
 * @param index 인덱스의 실젯값
 * */
public IndexOutOfBoundsException(int lowerBound, int upperBound, int index) {
    // 실패를 포착하는 상세 메세지를 생성한다.
    super(String.format(
        "최솟값: %d, 최댓값: %d, 인덱스: %d",
        lowerBound, upperBound, index));
    
    // 프로그램에서 이용할 수 있도록 실패 정보를 저장해둔다.
    this.lowerBound = lowerBound;
    this.upperBound = upperBound;
    this.index = index;
}
```
> 자바 9에서는 IndexOutOfBoundsException 에 드디어 정수 인덱스 값을 받는 생성자가 추가되었다.
> 그러나 아쉽게도 최솟값과 최대값까지 받지는 않는다.

포착한 실패 정보는 예외 상황을 복구하는 데 유용하 수 있으므로 접근자 메서드는 비검사 예외보다는 검사 예외에서 더 빛을 발한다.
비검사 예외의 상세 정보에 프로그램적으로 접근하길 원하는 개발자는 드물 것이다. 
하지만 'toString 이 반환한 값에 포함된 정보를 얻어올 수 있는 API를 제공하자'하는 일반원칙을 따른다는 관점에서,
비검사 예외라도 상세 정보를 알려주는 접근자 메서드를 제공하라